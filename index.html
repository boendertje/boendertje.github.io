<html>
<head>
</head>
<body>

<button id="button">
connect
</button>

<button id="mode1">
mode 1
</button>
<button id="mode2">
mode 2
</button>
<button id="mode3">
mode 3
</button>
<button id="mode4">
mode 4
</button>
<div id="colorpicker1">
<p>kleur 1: </p>
<input type="color" />
<div/>
<div id="colorpicker2">
<p>kleur 2: </p>
<input type="color" />
<div/>
<div id="error">
</div>
<script >
var button = document.getElementById("button");
button.addEventListener('click', function(event) {
onButtonClick();
});


var bluetoothDevice;

function onButtonClick() {
  bluetoothDevice = null;
  debugLog('Requesting any Bluetooth Device...');
  navigator.bluetooth.requestDevice({
     // filters: [...] <- Prefer filters to save energy & show relevant devices.
     acceptAllDevices: true})
  .then(device => {
    bluetoothDevice = device;
    bluetoothDevice.addEventListener('gattserverdisconnected', onDisconnected);
    connect();
  })
  .catch(error => {
    debugLog('Argh! ' + error);
  });
}

function connect() {
  exponentialBackoff(3 /* max retries */, 2 /* seconds delay */,
    function toTry() {
      time('Connecting to Bluetooth Device... ');
      return bluetoothDevice.gatt.connect();
    },
    function success() {
      debugLog('> Bluetooth Device connected. Try disconnect it now.');
	  
let txt = "";
			for (let x in bluetoothDevice) {
			txt += bluetoothDevice[x] + " ";
}; debugLog(txt);
    },
    function fail() {
      time('Failed to reconnect.');
    });
}

function onDisconnected() {
  debugLog('> Bluetooth Device disconnected');
  connect();
}

/* Utils */

// This function keeps calling "toTry" until promise resolves or has
// retried "max" number of times. First retry has a delay of "delay" seconds.
// "success" is called upon success.
function exponentialBackoff(max, delay, toTry, success, fail) {
  toTry().then(result => success(result))
  .catch(_ => {
    if (max === 0) {
      return fail();
    }
    time('Retrying in ' + delay + 's... (' + max + ' tries left)');
    setTimeout(function() {
      exponentialBackoff(--max, delay * 2, toTry, success, fail);
    }, delay * 1000);
  });
}

function time(text) {
  debugLog('[' + new Date().toJSON().substr(11, 8) + '] ' + text);
}
function debugLog(error)
{
	document.getElementById("error").innerHTML += error; 
}
</script>
</body>
</html>